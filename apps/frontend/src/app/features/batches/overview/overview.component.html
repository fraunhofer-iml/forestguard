<h1 class="font-semibold text-gray-700 pb-4">Batches</h1>
<div>
  <div class="card flex items-center justify-between gap-4">
    <mat-form-field class="w-full mb-0" appearance="outline">
      <mat-label>Filter</mat-label>
      <input matInput placeholder="Search" #input (keyup)="applyFilter($event)" />
    </mat-form-field>
    <div class="flex flex-row gap-4 items-center">
      <a href="/batches/harvest" mat-button class="w-full text-nowrap">Add Harvest</a>
      <button
        href="/batches/update"
        mat-flat-button
        class="w-full text-nowrap"
        [disabled]="!selection.hasValue()"
        (click)="routeToAddProcess()"
      >
        Add Process
      </button>
    </div>
  </div>

  <div class="card mt-4">
    <table mat-table *ngIf="batches$ | async as batches" [dataSource]="batches" matSort>
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? toggleAllRows() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
            [aria-label]="checkboxLabel()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
            [aria-label]="checkboxLabel(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Batch ID -->
      <ng-container matColumnDef="batchId">
        <th mat-header-cell id="id" *matHeaderCellDef mat-sort-header="id">Batch ID</th>
        <td mat-cell *matCellDef="let el">
          <a class="text-secondary-500 hover:underline" [routerLink]="'/batches/' + el.id">{{ el.id }}</a>
        </td>
      </ng-container>

      <!-- Weight -->
      <ng-container matColumnDef="weight">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="!text-right">Weight [kg]</th>
        <td mat-cell class="!text-right" *matCellDef="let el; dataSource: batches">{{ el.weight }}</td>
      </ng-container>

      <!-- Process -->
      <ng-container matColumnDef="process">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="processStep.process.name">Process</th>
        <td mat-cell *matCellDef="let el; dataSource: batches">{{ el.processStep.process.name }}</td>
      </ng-container>

      <!-- Date -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="processStep.date">Date</th>
        <td mat-cell *matCellDef="let el; dataSource: batches">{{ el.processStep.date | date }}</td>
      </ng-container>

      <!-- Process Owner -->
      <ng-container matColumnDef="processOwner">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="processStep.executedBy.lastName">Process Owner</th>
        <td mat-cell *matCellDef="let el; dataSource: batches">{{ getUserOrCompanyName(el.processStep.executedBy) }}</td>
      </ng-container>

      <!-- Row shown when there is no matching data. -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No data matching the filter "{{ input.value }}"</td>
      </tr>

      <tr mat-header-row *matHeaderRowDef="displayedColumnsOfBatches"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsOfBatches"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[10]" [pageSize]="10"></mat-paginator>
  </div>
</div>
