<header class="font-semibold pb-4 flex flex-row gap-2 text-neutral-300 items-center">
  <a routerLink="/batches" class="font-semibold text-gray-700 hover:underline">Batches</a>
  <span class="material-symbols-outlined text-lg"> chevron_right </span>
  <h1 class="font-medium">{{ id$ | async }}</h1>
  <p
    *ngIf="batch$ | async as batch"
    [ngClass]="batch.active ? 'bg-green-600' : 'bg-gray-400'"
    class="ml-auto text-white rounded-full px-4 py-2 mb-4"
  >
    Status: {{ isBatchActive(batch.active) }}
  </p>
</header>

<div *ngIf="batch$ | async as batch">
  <div class="card">
    <div class="flex flex-row items-center justify-between">
      <div>
        <span class="text-neutral-500 text-sm">{{ batch.processStep.process.name }}</span>
        <h2 class="text-lg font-medium text-neutral-400">Batch {{ batch.id }}</h2>
        <span class="text-neutral-500 text-sm">Weight [kg] {{ batch.weight }}</span>
      </div>
      <div class="grid grid-cols-2 space-x-4 text-neutral-500">
        <p class="text-right font-medium">Process Date</p>
        <p>{{ batch.processStep.date | date }}</p>
        <p class="text-right font-medium">Process Owner</p>
        <p>{{ getUserOrCompanyName(batch.processStep.executedBy) }}</p>
        <p class="text-right font-medium">Recipient</p>
        <p>{{ getUserOrCompanyName(batch.recipient) }}</p>
        <p class="text-right font-medium">Author of Entry</p>
        <p>{{ getUserOrCompanyName(batch.processStep.recordedBy) }}</p>
      </div>
    </div>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4" *ngIf="batch.processStep.farmedLand">
    <div class="card text-neutral-300">
      <h1 class="text-lg font-semibold">{{ batch.processStep.process.name }} Details</h1>
      <div class="mt-8 grid grid-cols-1 md:grid-cols-2">
        <span class="border-b-2 py-2 font-medium">Field</span>
        <p class="border-b-2 py-2 text-neutral-500">{{ batch.processStep.farmedLand.description }}</p>
        <span class="py-2 font-medium">Sort of Coffee</span>
        <p class="py-2 text-neutral-500">{{ batch.processStep.farmedLand.cultivatedWith?.sort }}</p>
      </div>
    </div>
    <div class="card text-neutral-300">
      <h1 class="text-lg font-semibold">PDF Documents</h1>
      <div class="h-full flex items-center justify-start w-full">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center w-full justify-center">
          <div>Proof of Freedom from deforestation</div>
          <div
            class="space-x-4 flex flex-row select-none w-full justify-end"
            *ngIf="getProof(ProofType.PROOF_OF_FREEDOM, batch.processStep.farmedLand?.proofs) as proof; else notUploaded"
          >
            <div class="p-1 h-10 w-10 rounded-full bg-green-600 flex items-center justify-center">
              <span class="material-symbols-outlined text-white"> done </span>
            </div>
            <div class="p-1 h-10 w-10 rounded-full hover:bg-gray-200 flex items-center justify-center cursor-pointer">
              <a class="material-symbols-outlined" [href]="MINIO_URL + proof.documentRef"> file_download </a>
            </div>
          </div>
          <ng-template #notUploaded>
            <div class="space-x-4 flex flex-row select-none w-full justify-end">
              <div class="p-1 h-10 w-10 rounded-full bg-orange-500 flex items-center justify-center">
                <span class="material-symbols-outlined text-white"> warning </span>
              </div>
              <div class="p-1 h-10 w-10 rounded-full hover:bg-gray-200 flex items-center justify-center cursor-not-allowed">
                <span class="material-symbols-outlined text-gray-300"> file_download </span>
              </div>
            </div>
          </ng-template>

          <div>Proof of Ownership for plot of land</div>
          <div
            class="space-x-4 flex flex-row select-none w-full justify-end"
            *ngIf="getProof(ProofType.PROOF_OF_OWNERSHIP, batch.processStep.farmedLand?.proofs) as proof; else notUploaded"
          >
            <div class="p-1 h-10 w-10 rounded-full bg-green-600 flex items-center justify-center">
              <span class="material-symbols-outlined text-white"> done </span>
            </div>
            <div class="p-1 h-10 w-10 rounded-full hover:bg-gray-200 flex items-center justify-center cursor-pointer">
              <a class="material-symbols-outlined" [href]="MINIO_URL + proof.documentRef"> file_download </a>
            </div>
          </div>
          <ng-template #notUploaded>
            <div class="space-x-4 flex flex-row select-none w-full justify-end">
              <div class="p-1 h-10 w-10 rounded-full bg-orange-500 flex items-center justify-center">
                <span class="material-symbols-outlined text-white"> warning </span>
              </div>
              <div class="p-1 h-10 w-10 rounded-full hover:bg-gray-200 flex items-center justify-center cursor-not-allowed">
                <span class="material-symbols-outlined text-gray-300"> file_download </span>
              </div>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
  <div class="card mt-4">
    <h1 class="text-lg font-semibold">Dependecy Graph</h1>
    <lib-ui-graph [data]="data$ | async" [width]="innerWidth - 450" (nodeClick)="routeToNode($event)" [selectedNode]="batch.id" />
  </div>
</div>
